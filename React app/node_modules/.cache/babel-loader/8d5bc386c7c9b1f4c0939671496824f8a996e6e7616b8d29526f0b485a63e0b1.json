{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Main(_ref){let{user,selectedFriend,setAuthenticated}=_ref;const navigate=useNavigate();const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState(\"\");useEffect(()=>{fetchMessages();},[selectedFriend]);const fetchMessages=async()=>{if(!selectedFriend)return;try{const response=await fetch(`/api/messages?friendId=${selectedFriend.user_id}`,{method:'GET',credentials:'include'});const data=await response.json();const sortedMessages=data.messages.sort((a,b)=>new Date(a.time)-new Date(b.time));setMessages(sortedMessages);}catch(error){console.error('Error fetching messages:',error);}};const messageSent=async message=>{try{const response=await fetch('/api/sendMessage',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({message,friendId:selectedFriend.user_id})});const data=await response.json();if(response.ok){setMessages(prevMessages=>[...prevMessages,data]);setNewMessage(\"\");}}catch(error){console.error('Error sending message',error);}};const handleSendMessage=e=>{e.preventDefault();if(newMessage.trim()){messageSent(newMessage);}};const handleLogout=async()=>{try{const response=await fetch('/logout',{method:'GET',credentials:'include'});if(response.ok){const data=await response.json();console.log(data.message);setAuthenticated(false);navigate('/');}else{console.error(\"Logout failed\");}}catch(error){console.error('Error during logout:',error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"main-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main-header\",children:[selectedFriend?selectedFriend.name:\"Select a friend\",/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,children:\"Logout\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"main-messages\",children:messages.length>0?messages.map((msg,index)=>/*#__PURE__*/_jsx(\"div\",{className:msg.sender===selectedFriend.name?\"friend-message\":\"user-message\",children:/*#__PURE__*/_jsx(\"span\",{children:msg.message})},index)):/*#__PURE__*/_jsx(\"div\",{children:\"You are so lonely\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"main-input\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,children:[/*#__PURE__*/_jsx(\"input\",{id:\"message-input\",name:\"message\",type:\"text\",placeholder:\"Type your message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Send\"})]})})]});}export default Main;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","jsx","_jsx","jsxs","_jsxs","Main","_ref","user","selectedFriend","setAuthenticated","navigate","messages","setMessages","newMessage","setNewMessage","fetchMessages","response","fetch","user_id","method","credentials","data","json","sortedMessages","sort","a","b","Date","time","error","console","messageSent","message","headers","body","JSON","stringify","friendId","ok","prevMessages","handleSendMessage","e","preventDefault","trim","handleLogout","log","className","children","name","onClick","length","map","msg","index","sender","onSubmit","id","type","placeholder","value","onChange","target"],"sources":["C:/Users/Aniket Sahu/Desktop/Projects/Messaging site/React app/src/components/main.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nfunction Main({ user, selectedFriend, setAuthenticated }) {\r\n    const navigate = useNavigate();\r\n    const [messages, setMessages] = useState([]);\r\n    const [newMessage, setNewMessage] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        fetchMessages();\r\n    }, [selectedFriend]);\r\n\r\n    const fetchMessages = async () => {\r\n        if (!selectedFriend) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/messages?friendId=${selectedFriend.user_id}`, {\r\n                method: 'GET',\r\n                credentials: 'include',\r\n            });\r\n            const data = await response.json();\r\n            const sortedMessages = data.messages.sort((a, b) => new Date(a.time) - new Date(b.time));\r\n            setMessages(sortedMessages);\r\n        } catch (error) {\r\n            console.error('Error fetching messages:', error);\r\n        }\r\n    };\r\n\r\n    const messageSent = async (message) => {\r\n        try {\r\n            const response = await fetch('/api/sendMessage', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                credentials: 'include',\r\n                body: JSON.stringify({\r\n                    message,\r\n                    friendId: selectedFriend.user_id,\r\n                }),\r\n            });\r\n            const data = await response.json();\r\n\r\n            if (response.ok) {\r\n                setMessages((prevMessages) => [...prevMessages, data]);\r\n                setNewMessage(\"\");\r\n            }\r\n        } catch (error) {\r\n            console.error('Error sending message', error);\r\n        }\r\n    };\r\n\r\n    const handleSendMessage = (e) => {\r\n        e.preventDefault();\r\n        if (newMessage.trim()) {\r\n            messageSent(newMessage);\r\n        }\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        try {\r\n            const response = await fetch('/logout', {\r\n                method: 'GET',\r\n                credentials: 'include',\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                console.log(data.message); \r\n                setAuthenticated(false); \r\n                navigate('/'); \r\n            } else {\r\n                console.error(\"Logout failed\");\r\n            }\r\n        } catch (error) {\r\n            console.error('Error during logout:', error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"main-container\">\r\n            <div className=\"main-header\">\r\n                {selectedFriend ? selectedFriend.name : \"Select a friend\"}\r\n                <button onClick={handleLogout}>Logout</button>\r\n            </div>\r\n            <div className=\"main-messages\">\r\n                {messages.length > 0 ? messages.map((msg, index) => (\r\n                    <div\r\n                        key={index}\r\n                        className={msg.sender === selectedFriend.name ? \"friend-message\" : \"user-message\"}>\r\n                        <span>{msg.message}</span>\r\n                    </div>\r\n                )): <div>You are so lonely</div>}\r\n            </div>\r\n            <div className=\"main-input\">\r\n                <form onSubmit={handleSendMessage}>\r\n                    <input\r\n                        id=\"message-input\"  \r\n                        name=\"message\"   \r\n                        type=\"text\"\r\n                        placeholder=\"Type your message...\"\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                    />\r\n                    <button type=\"submit\">Send</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Main;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}