{"ast":null,"code":"import React,{useState}from\"react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Main(_ref){let{user,selectedFriend}=_ref;const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState(\"\");useEffect(()=>{fetchMessages();},[selectedFriend]);const fetchMessages=async()=>{if(!selectedFriend)return;try{const response=await fetch(`/api/messages?friendId=${selectedFriend.id}`,{method:'GET',credentials:'include'});const data=await response.json();const sortedMessages=data.messages.sort((a,b)=>new Date(a.time)-new Date(b.time));setMessages(sortedMessages);}catch(error){console.error('Error fetching messages:',error);}};const messageSent=async message=>{try{const response=await fetch('/api/sendMessage',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({message,friendId:selectedFriend.id})});const data=await response.json();if(response.ok){setMessages(prevMessages=>[...prevMessages,data]);setNewMessage(\"\");}}catch(error){console.error('Error sending message',error);}};const handleSendMessage=e=>{e.preventDefault();if(newMessage.trim()){messageSent(newMessage);}};const handleLogout=async()=>{try{const response=await fetch('/logout',{method:'GET',credentials:'include'});if(response.ok){navigate('/');}else{console.error(\"Logout failed\");}}catch(error){console.error('Error during logout:',error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"main-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main-header\",children:[selectedFriend?selectedFriend.name:\"Select a friend\",/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,children:\"Logout\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"main-messages\",children:messages.map((msg,index)=>/*#__PURE__*/_jsx(\"div\",{className:msg.sender===selectedFriend.name?\"friend-message\":\"user-message\",children:/*#__PURE__*/_jsx(\"span\",{children:msg.message})},index))}),/*#__PURE__*/_jsx(\"div\",{className:\"main-input\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type your message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Send\"})]})})]});}export default Main;","map":{"version":3,"names":["React","useState","jsx","_jsx","jsxs","_jsxs","Main","_ref","user","selectedFriend","messages","setMessages","newMessage","setNewMessage","useEffect","fetchMessages","response","fetch","id","method","credentials","data","json","sortedMessages","sort","a","b","Date","time","error","console","messageSent","message","headers","body","JSON","stringify","friendId","ok","prevMessages","handleSendMessage","e","preventDefault","trim","handleLogout","navigate","className","children","name","onClick","map","msg","index","sender","onSubmit","type","placeholder","value","onChange","target"],"sources":["C:/Users/Aniket Sahu/Desktop/Projects/Messaging site/React app/src/components/main.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\n\r\nfunction Main({ user, selectedFriend }) {\r\n    const [messages, setMessages] = useState([]);\r\n    const [newMessage, setNewMessage] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        fetchMessages();\r\n    }, [selectedFriend]);\r\n\r\n    const fetchMessages = async () => {\r\n        if (!selectedFriend) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/messages?friendId=${selectedFriend.id}`, {\r\n                method: 'GET',\r\n                credentials: 'include',\r\n            });\r\n            const data = await response.json();\r\n            const sortedMessages = data.messages.sort((a, b) => new Date(a.time) - new Date(b.time));\r\n            setMessages(sortedMessages);\r\n        } catch (error) {\r\n            console.error('Error fetching messages:', error);\r\n        }\r\n    };\r\n\r\n    const messageSent = async (message) => {\r\n        try {\r\n            const response = await fetch('/api/sendMessage', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                credentials: 'include',\r\n                body: JSON.stringify({\r\n                    message,\r\n                    friendId: selectedFriend.id,\r\n                }),\r\n            });\r\n            const data = await response.json();\r\n\r\n            if (response.ok) {\r\n                setMessages((prevMessages) => [...prevMessages, data]);\r\n                setNewMessage(\"\");\r\n            }\r\n        } catch (error) {\r\n            console.error('Error sending message', error);\r\n        }\r\n    };\r\n\r\n    const handleSendMessage = (e) => {\r\n        e.preventDefault();\r\n        if (newMessage.trim()) {\r\n            messageSent(newMessage);\r\n        }\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        try {\r\n            const response = await fetch('/logout', {\r\n                method: 'GET',\r\n                credentials: 'include',\r\n            });\r\n\r\n            if (response.ok) {\r\n                navigate('/');\r\n            } else {\r\n                console.error(\"Logout failed\");\r\n            }\r\n        } catch (error) {\r\n            console.error('Error during logout:', error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"main-container\">\r\n            <div className=\"main-header\">\r\n                {selectedFriend ? selectedFriend.name : \"Select a friend\"}\r\n                <button onClick={handleLogout}>Logout</button>\r\n            </div>\r\n            <div className=\"main-messages\">\r\n                {messages.map((msg, index) => (\r\n                    <div\r\n                        key={index}\r\n                        className={msg.sender === selectedFriend.name ? \"friend-message\" : \"user-message\"}>\r\n                        <span>{msg.message}</span>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            <div className=\"main-input\">\r\n                <form onSubmit={handleSendMessage}>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Type your message...\"\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                    />\r\n                    <button type=\"submit\">Send</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Main;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExC,QAAS,CAAAC,IAAIA,CAAAC,IAAA,CAA2B,IAA1B,CAAEC,IAAI,CAAEC,cAAe,CAAC,CAAAF,IAAA,CAClC,KAAM,CAACG,QAAQ,CAAEC,WAAW,CAAC,CAAGV,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACW,UAAU,CAAEC,aAAa,CAAC,CAAGZ,QAAQ,CAAC,EAAE,CAAC,CAEhDa,SAAS,CAAC,IAAM,CACZC,aAAa,CAAC,CAAC,CACnB,CAAC,CAAE,CAACN,cAAc,CAAC,CAAC,CAEpB,KAAM,CAAAM,aAAa,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CAACN,cAAc,CAAE,OAErB,GAAI,CACA,KAAM,CAAAO,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,0BAA0BR,cAAc,CAACS,EAAE,EAAE,CAAE,CACxEC,MAAM,CAAE,KAAK,CACbC,WAAW,CAAE,SACjB,CAAC,CAAC,CACF,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CAClC,KAAM,CAAAC,cAAc,CAAGF,IAAI,CAACX,QAAQ,CAACc,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,GAAI,CAAAC,IAAI,CAACF,CAAC,CAACG,IAAI,CAAC,CAAG,GAAI,CAAAD,IAAI,CAACD,CAAC,CAACE,IAAI,CAAC,CAAC,CACxFjB,WAAW,CAACY,cAAc,CAAC,CAC/B,CAAE,MAAOM,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CACpD,CACJ,CAAC,CAED,KAAM,CAAAE,WAAW,CAAG,KAAO,CAAAC,OAAO,EAAK,CACnC,GAAI,CACA,KAAM,CAAAhB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,kBAAkB,CAAE,CAC7CE,MAAM,CAAE,MAAM,CACdc,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/Cb,WAAW,CAAE,SAAS,CACtBc,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACjBJ,OAAO,CACPK,QAAQ,CAAE5B,cAAc,CAACS,EAC7B,CAAC,CACL,CAAC,CAAC,CACF,KAAM,CAAAG,IAAI,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CAElC,GAAIN,QAAQ,CAACsB,EAAE,CAAE,CACb3B,WAAW,CAAE4B,YAAY,EAAK,CAAC,GAAGA,YAAY,CAAElB,IAAI,CAAC,CAAC,CACtDR,aAAa,CAAC,EAAE,CAAC,CACrB,CACJ,CAAE,MAAOgB,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CACjD,CACJ,CAAC,CAED,KAAM,CAAAW,iBAAiB,CAAIC,CAAC,EAAK,CAC7BA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClB,GAAI9B,UAAU,CAAC+B,IAAI,CAAC,CAAC,CAAE,CACnBZ,WAAW,CAACnB,UAAU,CAAC,CAC3B,CACJ,CAAC,CAED,KAAM,CAAAgC,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,CACA,KAAM,CAAA5B,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,SAAS,CAAE,CACpCE,MAAM,CAAE,KAAK,CACbC,WAAW,CAAE,SACjB,CAAC,CAAC,CAEF,GAAIJ,QAAQ,CAACsB,EAAE,CAAE,CACbO,QAAQ,CAAC,GAAG,CAAC,CACjB,CAAC,IAAM,CACHf,OAAO,CAACD,KAAK,CAAC,eAAe,CAAC,CAClC,CACJ,CAAE,MAAOA,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,sBAAsB,CAAEA,KAAK,CAAC,CAChD,CACJ,CAAC,CAED,mBACIxB,KAAA,QAAKyC,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC3B1C,KAAA,QAAKyC,SAAS,CAAC,aAAa,CAAAC,QAAA,EACvBtC,cAAc,CAAGA,cAAc,CAACuC,IAAI,CAAG,iBAAiB,cACzD7C,IAAA,WAAQ8C,OAAO,CAAEL,YAAa,CAAAG,QAAA,CAAC,QAAM,CAAQ,CAAC,EAC7C,CAAC,cACN5C,IAAA,QAAK2C,SAAS,CAAC,eAAe,CAAAC,QAAA,CACzBrC,QAAQ,CAACwC,GAAG,CAAC,CAACC,GAAG,CAAEC,KAAK,gBACrBjD,IAAA,QAEI2C,SAAS,CAAEK,GAAG,CAACE,MAAM,GAAK5C,cAAc,CAACuC,IAAI,CAAG,gBAAgB,CAAG,cAAe,CAAAD,QAAA,cAClF5C,IAAA,SAAA4C,QAAA,CAAOI,GAAG,CAACnB,OAAO,CAAO,CAAC,EAFrBoB,KAGJ,CACR,CAAC,CACD,CAAC,cACNjD,IAAA,QAAK2C,SAAS,CAAC,YAAY,CAAAC,QAAA,cACvB1C,KAAA,SAAMiD,QAAQ,CAAEd,iBAAkB,CAAAO,QAAA,eAC9B5C,IAAA,UACIoD,IAAI,CAAC,MAAM,CACXC,WAAW,CAAC,sBAAsB,CAClCC,KAAK,CAAE7C,UAAW,CAClB8C,QAAQ,CAAGjB,CAAC,EAAK5B,aAAa,CAAC4B,CAAC,CAACkB,MAAM,CAACF,KAAK,CAAE,CAClD,CAAC,cACFtD,IAAA,WAAQoD,IAAI,CAAC,QAAQ,CAAAR,QAAA,CAAC,MAAI,CAAQ,CAAC,EACjC,CAAC,CACN,CAAC,EACL,CAAC,CAEd,CAEA,cAAe,CAAAzC,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}